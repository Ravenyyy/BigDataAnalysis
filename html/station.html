<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="../css/station.css" />
  <link rel="stylesheet" href="../css/modal.css" />
  <link rel="stylesheet" type="text/css" href="../library/iview/iview.css">
  <script type="text/javascript" src="../library/vue/vue.min.js"></script>
  <script type="text/javascript" src="../library/iview/iview.min.js.map"></script>
</head>

<body>
  <header>
    <h1><span id="title"></span>消防救援队伍教育管理大数据研判平台</h1>
    <div class="showTime" id="showTime"></div>
    <div class="bnt">
      <ul>
        <li><a onclick="downloadReport()">报告下载</a></li>
        <li><a href="#">分析研判</a></li>
        <li><a onclick="back()" href="index.html">返回上级</a></li>
      </ul>
    </div>
    <script>
    </script>
  </header>
  <section class="mainbox">
    <div class="column">

      <div class="panel dangjian">
        <h2 onclick="toDjDetail()">智慧党建</h2>
        <div class="half-div2" id="dj1"></div>
        <div class="half-div2" id="dj2"></div>
        <div class="panel-footer"></div>
      </div>

      <div class="panel education">
        <h2 onclick="toEduDetail()">政治教育</h2>
        <div class="quarter-div" id="edu_1"></div>
        <div class="quarter-div" id="edu_2"></div>
        <div class="half-div" id="edu_3"></div>

        <div class="panel-footer"></div>
      </div>

      <div class="panel bar">
        <h2 onclick="toHeartDetail()">
          心理测询
        </h2>
        <div class="quarter-div" id="heart_1"></div>
        <div class="quarter-div" id="heart_2"></div>
        <div class="quarter-div" id="heart_3"></div>
        <div class="quarter-div" id="heart_4"></div>
        <div class="panel-footer"></div>
      </div>
    </div>
    <div class="column">
      <div class="no">
        <div class="no-hd">
          <ul>
            <li class="shadow-green" id="totalNum"></li>
            <li class="shadow-yellow" id="activeNum"></li>
            <li class="shadow-red" id="keyNum"></li>
          </ul>
        </div>
        <div class="no-bd">
          <ul>
            <li style="color: white">全体指战员</li>
            <li style="color: white">活跃人员</li>
            <li style="color: white">重点关注人员</li>
          </ul>
        </div>
      </div>
      <div class="map">
        <div class="chart" id="map"></div>
        <div class="map1"></div>
        <div class="map2"></div>
        <div class="map3"></div>
      </div>

      <div class="panel assessment">
        <h2 onclick="toAssessDetail()">全员考核</h2>
        <div class="half-assess" id="assess_1"></div>
        <div class="half-assess" id="assess_2" style="overflow-y: scroll;height: 3rem;">
          <h3>优秀人员列表</h3>
          <!-- <div class="flow" style="overflow-y: scroll;height: 3rem;"> -->
          <table id="asswss_tb">
            <tr>
              <th>排名</th>
              <th>姓名</th>
              <th>分数</th>
            </tr>
          </table>
          <!-- </div> -->
        </div>
        <div class="panel-footer"></div>
      </div>



    </div>
    <div class="column">

      <div class="double-panel">
        <h2 onclick="toWarningDetail()">风险预警</h2>
        <!--<div class="message_scroll">
          <div class="scroll_top">
            <span class="scroll_title">武汉支队</span>
            <span class="scroll_timer">2020-08-11 1:00</span>
          </div>
          <div class="msg_cage">
            <span class="localize_msg">xxx考试成绩不合格</span>
          </div>
        </div>-->
        <h3>最新待处理风险预警信息</h3>
        <div class="table" style="overflow-y: scroll;">
          <table id="wn_tb1">
            <tr>
              <th class="tb_zhidui">姓名</th>
              <th class="tb_time">时间</th>
              <th class="tb_type">类型</th>
              <th class="tb_content">内容</th>
            </tr>
          </table>
          <div class="panel-footer"></div>
        </div>

        <h3>正在处理风险预警信息</h3>
        <div class="table1" style="overflow-y: scroll;">
          <table id="wn_tb2">
            <tr>
              <th class="tb_zhidui">姓名</th>
              <th class="tb_time">时间</th>
              <th class="tb_type">类型</th>
              <th class="tb_content">内容</th>
            </tr>
          </table>
          <div class="panel-footer"></div>
        </div>
        <div class="panel-footer"></div>


      <h3>完成处理风险预警信息</h3>
        <div class="table2" style="overflow-y: scroll;">
          <table id="wn_tb3">
            <tr>
              <th class="tb_zhidui">支队</th>
              <th class="tb_time">时间</th>
              <th class="tb_type">类型</th>
              <th class="tb_content">内容</th>
            </tr>
          </table>
          <div class="panel-footer"></div>
        </div>
        <div class="panel-footer"></div>
      </div>

    </div>

      <!-- <div class="panel" >
        <h2> 关键词</h2>
        <div class="half-table">
          <h3>常态关键词</h3>
          <div style="overflow-y:scroll;height: 2.65rem">
            <table id="hots_tb" >
              <tr>
                <th >排名</th>
                <th >敏感词</th>
                <th >次数</th>
                <th >人数</th>
              </tr>
            </table>
          </div>>
          <div class="panel-footer"></div>
        </div>
        <div class="half-table" style="margin-left: 1%">
          <h3>极端敏感词</h3>
          <div style="overflow-y:scroll;height: 2.65rem">
            <table id="sens_tb" >
              <tr>
                <th >排名</th>
                <th >敏感词</th>
                <th >次数</th>
                <th >人数</th>
              </tr>
            </table>
          </div>>
          <div class="panel-footer"></div>
        </div>
      </div> -->
    </div>
  </section>
  <div id="simpleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="closeBtn">&times;</span>
        <h2>预 警 信 息 处 理</h2>
      </div>
      <div class="modal-body">
        <p style="font-size: 0.3rem; text-align: center;">最新风险预警信息</p>
        <ul id="modal-ul">
          <li></li>
          <li></li>
          <li></li>
        </ul>
        <form>
          <label>处理意见:</label>&nbsp;&nbsp;
          <textarea name="opinion"></textarea>
          <br><br>
          处理状态:&nbsp;&nbsp;
          <input type="radio" name="state" value="0">待处理&nbsp;
          <input type="radio" name="state" value="1">正在处理&nbsp;
          <input type="radio" name="state" value="2">处理完成&nbsp;
        </form>
        <div class="handle">
          <button onclick="submit()">保存</button>
          <button onclick="closeModal()">关闭</button>
        </div>
      </div>
      <!-- <div class="modal-footer">
            <h3>弹框底部</h3>
        </div> -->
    </div>
  </div>
  <div id="mb">
    <div id="loading">
      报告生成中
    </div>
  </div>
</body>
<script src="../js/flexible.js"></script>
<script src="../js/jquery.js"></script>
<script src="../js/echarts.min.js"></script>
<script src="../js/station.js"></script>
<script src="../js/main/date.js"></script>
<script src="../js/spin.min.js"></script>
<script>
  // onload
  $(function () {
    console.log(localStorage.getItem("unitId"))
    console.log(localStorage.getItem("unitName"))
    document.getElementById("title").innerHTML = localStorage.getItem("unitName")

    getDjData();
    getAssessData();
    getHeartData();
    getEduData();
/*    getSmartData();*/
    tb_wn1();
    tb_wn2();
    tb_wn3();

    tb_hots();
    tb_sens();


    $.ajax({
      type: 'GET',
      url: localStorage.getItem("url") + 'unit/getUnitById',
      traditional: true,
      data: {
        id: localStorage.getItem("unitId")
      },
      success: function (response) {
        document.getElementById("totalNum").innerHTML = response.extra.unit.totalNum;
        document.getElementById("activeNum").innerHTML = response.extra.unit.activeNum;
        document.getElementById("keyNum").innerHTML = response.extra.unit.keyNum;
      },
      error: function (response) {
        console.log(response);
      }
    })

  });

  // 获取弹窗元素
  var modal = document.getElementById("simpleModal");

  // 获取关闭弹窗按钮元素
  var closeBtn = document.getElementsByClassName("closeBtn")[0];

  // 监听关闭弹窗事件
  closeBtn.addEventListener("click", closeModal);

  // 监听window关闭弹窗事件
  window.addEventListener("click", outsideClick);

  // 关闭弹框事件
  function closeModal() {
    $('form')[0].reset();
    modal.style.display = "none";
  }

  // outsideClick
  function outsideClick(e) {
    if (e.target == modal) {
      modal.style.display = "none";
    }
  }

  function submit() {
    var data = $('form').serializeArray();
    console.log(data);
    var opinion = "";
    var type = 0;
    $.each(data, function (i, field) {
      if (field.name == "opinion") {
        opinion = field.value;
      }
      if (field.name == "state") {
        type = field.value;
      }
      console.log(field.name + ":" + field.value);
    });
    submitData(opinion, type);
    modal.style.display = "none";
  }

  var opts = {
    lines: 13, // 花瓣数目
    length: 12, // 花瓣长度
    width: 8, // 花瓣宽度
    radius: 40, // 花瓣距中心半径
    corners: 1, // 花瓣圆滑度 (0-1)
    rotate: 0, // 花瓣旋转角度
    direction: 1, // 花瓣旋转方向 1: 顺时针, -1: 逆时针
    color: '#fff', // 花瓣颜色
    speed: 1, // 花瓣旋转速度
    trail: 60, // 花瓣旋转时的拖影(百分比)
    shadow: false, // 花瓣是否显示阴影
    hwaccel: false, //spinner 是否启用硬件加速及高速旋转
    className: 'spinner', // spinner css 样式名称
    zIndex: 2e9, // spinner的z轴 (默认是2000000000)
    top: 'auto', // 菊花相对定位的top
    left: 'auto',// spinner 相对父容器Left定位 单位 px
};

var spinner = new Spinner(opts);

function startLoading () {
    //请求时spinner出现
    $("#mb").css("display", "block");
    var target = $('#loading').get(0);
    spinner.spin(target);
}

function stopLoading () {
    //关闭spinner
    $("#mb").css("display", "none");
    spinner.spin();
}
  function downloadReport() {
    // startLoading();
    var link = document.createElement("a");
    startLoading();
    $.ajax({
      type: 'GET',
      url: localStorage.getItem("url") + 'poi/getReport',
      data: {
        unitId: localStorage.getItem("unitId"),
        month: localStorage.getItem("month"),
      },
      success: function (response) {
        let url = '../static/jx/result.docx'
        link.setAttribute('href', url)
        if (link.download !== undefined) {
          link.download = "消防站月报.docx";
        }
        link.click();
        stopLoading();
      },
      error: function (response) {
        console.log(response);
        stopLoading();
      }
    })
  }

  function toDjDetail() {
    window.location = './stationDetail/djStationDetail.html'
  }

  function toEduDetail() {
    window.location = './stationDetail/eduStationDetail.html'
  }

  function toHeartDetail() {
    window.location = './stationDetail/heartStationDetail.html'
  }

  function toSmartDetail() {
    window.location = './stationDetail/smartStationDetail.html'
  }

  function toWarningDetail(){
    window.location = './stationDetail/warningStationDetail.html'
  }

  function toAssessDetail() {
    window.location = './stationDetail/assessStationDetail.html'
  }

  function back() {
    localStorage.setItem("unitId", localStorage.getItem("stationId"))
    localStorage.setItem("unitName", localStorage.getItem("stationName"))
    localStorage.setItem("level", 3)
  }
</script>

</html>