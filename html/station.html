<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="../css/station.css" />
  <link rel="stylesheet" href="../css/modal.css" />
  <link rel="stylesheet" type="text/css" href="../library/iview/iview.css">
  <script type="text/javascript" src="../library/vue/vue.min.js"></script>
  <script type="text/javascript" src="../library/iview/iview.min.js.map"></script>
</head>

<body>
  <header>
    <h1><span id="title"></span>消防救援队伍教育管理大数据研判平台</h1>
    <div class="showTime" id="showTime"></div>
    <div class="bnt">
      <ul>
        <li><a href="#">报告下载</a></li>
        <li><a href="#">分析研判</a></li>
        <li><a onclick="back()" href="index.html">返回大队</a></li>
      </ul>
    </div>
    <script>
    </script>
  </header>
  <section class="mainbox">
    <div class="column">

      <div class="panel dangjian">
        <h2 onclick="toDjDetail()">智慧党建</h2>
        <div class="half-div2" id="dj1"></div>
        <div class="half-div2" id="dj2"></div>
        <div class="panel-footer"></div>
      </div>

      <div class="panel education">
        <h2 onclick="toEduDetail()">政治教育</h2>
        <div class="quarter-div" id="edu_1"></div>
        <div class="quarter-div" id="edu_2"></div>
        <div class="half-div" id="edu_3"></div>

        <div class="panel-footer"></div>
      </div>

      <div class="panel bar">
        <h2 onclick="toHeartDetail()">
          心理测询
        </h2>
        <div class="quarter-div" id="heart_1"></div>
        <div class="quarter-div" id="heart_2"></div>
        <div class="quarter-div" id="heart_3"></div>
        <div class="quarter-div" id="heart_4"></div>
        <div class="panel-footer"></div>
      </div>
    </div>
    <div class="column">
      <div class="no">
        <div class="no-hd">
          <ul>
            <li class="shadow-green" id="totalNum"></li>
            <li class="shadow-yellow" id="activeNum"></li>
            <li class="shadow-red" id="keyNum"></li>
          </ul>
        </div>
        <div class="no-bd">
          <ul>
            <li style="color: white">全体指战员</li>
            <li style="color: white">活跃人员</li>
            <li style="color: white">重点关注人员</li>
          </ul>
        </div>
      </div>
      <div class="map">
        <div class="chart" id="map"></div>
        <div class="map1"></div>
        <div class="map2"></div>
        <div class="map3"></div>
      </div>

      <div class="panel assessment">
        <h2 onclick="toAssessDetail()">全员考核</h2>
        <div class="half-assess" id="assess_1"></div>
        <div class="half-assess" id="assess_2" style="overflow-y: scroll;height: 3rem;">
          <h3>优秀人员列表</h3>
          <!-- <div class="flow" style="overflow-y: scroll;height: 3rem;"> -->
          <table id="asswss_tb">
            <tr>
              <th>排名</th>
              <th>姓名</th>
              <th>分数</th>
            </tr>
          </table>
          <!-- </div> -->
        </div>
        <div class="panel-footer"></div>
      </div>



    </div>
    <div class="column">

      <div class="double-panel">
        <h2>风险预警</h2>
        <!--<div class="message_scroll">
          <div class="scroll_top">
            <span class="scroll_title">武汉支队</span>
            <span class="scroll_timer">2020-08-11 1:00</span>
          </div>
          <div class="msg_cage">
            <span class="localize_msg">xxx考试成绩不合格</span>
          </div>
        </div>-->
        <h3>最新待处理风险预警信息</h3>
        <div class="table" style="overflow-y: scroll;">
          <table id="wn_tb1">
            <tr>
              <th class="tb_zhidui">姓名</th>
              <th class="tb_time">时间</th>
              <th class="tb_type">类型</th>
              <th class="tb_content">内容</th>
            </tr>
          </table>
          <div class="panel-footer"></div>
        </div>

        <h3>正在处理风险预警信息</h3>
        <div class="table1" style="overflow-y: scroll;">
          <table id="wn_tb2">
            <tr>
              <th class="tb_zhidui">姓名</th>
              <th class="tb_time">时间</th>
              <th class="tb_type">类型</th>
              <th class="tb_content">内容</th>
            </tr>
          </table>
          <div class="panel-footer"></div>
        </div>
        <div class="panel-footer"></div>
      </div>

      <div class="panel line1">
        <h2 onclick="toSmartDetail()">智慧队站</h2>
        <div class="chart" id="smart"></div>
        <div class="panel-footer"></div>
      </div>
    </div>
  </section>
  <div id="simpleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="closeBtn">&times;</span>
        <h2>预 警 信 息 处 理</h2>
      </div>
      <div class="modal-body">
        <p style="font-size: 0.3rem; text-align: center;">最新风险预警信息</p>
        <ul id="modal-ul">
          <li></li>
          <li></li>
          <li></li>
        </ul>
        <form>
          <label>处理意见:</label>&nbsp;&nbsp;
          <textarea name="opinion"></textarea>
          <br><br>
          处理状态:&nbsp;&nbsp;
          <input type="radio" name="state" value="0">待处理&nbsp;
          <input type="radio" name="state" value="1">正在处理&nbsp;
          <input type="radio" name="state" value="2">处理完成&nbsp;
        </form>
        <div class="handle">
          <button onclick="submit()">保存</button>
          <button onclick="closeModal()">关闭</button>
        </div>
      </div>
      <!-- <div class="modal-footer">
            <h3>弹框底部</h3>
        </div> -->
    </div>
  </div>
</body>
<script src="../js/flexible.js"></script>
<script src="../js/jquery.js"></script>
<script src="../js/echarts.min.js"></script>
<script src="../js/station.js"></script>
<script src="../js/main/date.js"></script>
<script>
  // onload
  $(function () {
    document.getElementById("title").innerHTML = localStorage.getItem("unitName")

    smart();
    getDjData();
    getAssessData();
    getHeartData();
    getEduData();
    tb_wn1();
    tb_wn2();

    $.ajax({
      type: 'GET',
      url: 'http://localhost:8880/unit/getUnitById',
      traditional: true,
      data: {
        id: localStorage.getItem("unitId")
      },
      success: function (response) {
        document.getElementById("totalNum").innerHTML = response.extra.unit.totalNum;
        document.getElementById("activeNum").innerHTML = response.extra.unit.activeNum;
        document.getElementById("keyNum").innerHTML = response.extra.unit.keyNum;
      },
      error: function (response) {
        console.log(response);
      }
    })

  });

  // 获取弹窗元素
  var modal = document.getElementById("simpleModal");

  // 获取关闭弹窗按钮元素
  var closeBtn = document.getElementsByClassName("closeBtn")[0];

  // 监听关闭弹窗事件
  closeBtn.addEventListener("click", closeModal);

  // 监听window关闭弹窗事件
  window.addEventListener("click", outsideClick);

  // 关闭弹框事件
  function closeModal() {
    $('form')[0].reset();
    modal.style.display = "none";
  }

  // outsideClick
  function outsideClick(e) {
    if (e.target == modal) {
      modal.style.display = "none";
    }
  }

  function submit() {
    var data = $('form').serializeArray();
    console.log(data);
    var opinion = "";
    var type = 0;
    $.each(data, function (i, field) {
      if (field.name == "opinion") {
        opinion = field.value;
      }
      if (field.name == "state") {
        type = field.value;
      }
      console.log(field.name + ":" + field.value);
    });
    submitData(opinion, type);
    modal.style.display = "none";
  }


  function toDjDetail() {
    window.location = './stationDetail/djStationDetail.html'
  }

  function toEduDetail() {
    window.location = './stationDetail/eduStationDetail.html'
  }

  function toHeartDetail() {
    window.location = './stationDetail/heartStationDetail.html'
  }

  function toSmartDetail() {
    window.location = './stationDetail/smartStationDetail.html'
  }

  function toAssessDetail() {
    window.location = './stationDetail/assessStationDetail.html'
  }

  function back() {
    $.ajax({
      type: 'GET',
      url: 'http://localhost:8880/unit/getFatherID',
      traditional: true,
      data: {
        id: localStorage.getItem("unitId")
      },
      success: function (response) {
        localStorage.setItem("unitId", response.extra.fatherId)
        localStorage.setItem("unitName", response.extra.unitName)
        localStorage.setItem("level", response.extra.unitLevel)
        console.log(localStorage.getItem("unitName"))
      },
      error: function (response) {
        console.log(response);
      }
    })
  }
</script>

</html>