<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="../css/index.css" />
  <link rel="stylesheet" href="../css/modal.css" />
  <link rel="stylesheet" type="text/css" href="../library/iview/iview.css">
  <script type="text/javascript" src="../library/vue/vue.min.js"></script>
  <script type="text/javascript" src="../library/iview/iview.min.js"></script>
  <script type="text/javascript"
    src="https://api.map.baidu.com/api?v=1.0&type=webgl&ak=mGxSq0nDy6k7OfjQ9vlPdvT3kxmKrMm5">
  </script>
</head>
<style>
  #mb {
    display: none;
    height: 100%;
    width: 100%;
    position: fixed;
    *position: absolute;
    *height: 1380px;
    background: black;
    top: 0;
    left: 0;
    opacity: 0.6;
    text-align:center;
    z-index: 9999;
  }

  #loading{
    position: absolute;
    top: 50%;
    left: 50%;
    z-index: 10000;
    font-size: 14px;
    color: white;
  }

</style>

<body>
  <header>
    <h1><span id="title">湖北</span>消防救援队伍教育管理大数据研判平台</h1>
    <div class="showTime" id="showTime"></div>
    <div class="bnt">
      <ul>
        <li><a onclick="downloadReport()">报告下载</a></li>
        <li><a href="analysis.html">分析研判</a></li>
        <li><a onclick="back()">返回上级</a></li>
      </ul>
    </div>
    <script>
    </script>
  </header>
  <section class="mainbox">
    <div class="column">

      <div class="panel dangjian">
        <h2 onclick="toDjDetail()">智慧党建</h2>
        <div class="quarter-div" id="dj1"></div>
        <div class="quarter-div" id="dj2"></div>
        <div class="quarter-div" id="dj3"></div>
        <div class="quarter-div" id="dj4"></div>
        <div class="panel-footer"></div>
      </div>

      <div class="panel education">
        <h2 onclick="toEduDetail()">政治教育</h2>
        <div class="chart" id="edu_1"></div>
        <div class="panel-footer"></div>
      </div>

      <div class="panel bar">
        <h2 onclick="toHeartDetail()">
          心理测询
        </h2>
        <div class="quarter-div" id="heart_1"></div>
        <div class="quarter-div" id="heart_2"></div>
        <div class="quarter-div" id="heart_3"></div>
        <div class="quarter-div" id="heart_4"></div>
        <div class="panel-footer"></div>
      </div>
    </div>
    <div class="column">
      <div class="no">
        <div class="no-hd">
          <ul>
            <li class="shadow-green" id="totalNum"></li>
            <li class="shadow-yellow" id="activeNum"></li>
            <li class="shadow-red" id="keyNum"></li>
          </ul>
        </div>
        <div class="no-bd">
          <ul>
            <li style="color: white">全体指战员</li>
            <li style="color: white">活跃人员</li>
            <li style="color: white">重点关注人员</li>
          </ul>
        </div>
      </div>
      <div class="map">
        <div class="chart" id="map"></div>
        <!--        <div class="map1"></div>
        <div class="map2"></div>
        <div class="map3"></div>-->
      </div>

      <div class="panel assessment">
        <h2 onclick="toAssessDetail()">全员考核</h2>
        <div class="quarter-assess" id="assess_2"></div>
        <div class="quarter-assess" id="assess_3"></div>
        <div class="quarter-assess" id="assess_4"></div>
        <div class="quarter-assess" id="assess_5"></div>
        <div class="half-assess" id="assess_1"></div>
        <div class="panel-footer"></div>
      </div>



    </div>
    <div class="column">

      <div class="double-panel">
        <h2>风险预警</h2>
        <!--<div class="message_scroll">
          <div class="scroll_top">
            <span class="scroll_title">武汉支队</span>
            <span class="scroll_timer">2020-08-11 1:00</span>
          </div>
          <div class="msg_cage">
            <span class="localize_msg">xxx考试成绩不合格</span>
          </div>
        </div>-->
        <h3>最新待处理风险预警信息</h3>
        <div class="table" style="overflow-y: scroll;">
          <table id="wn_tb1">
            <tr>
              <th class="tb_zhidui">支队</th>
              <th class="tb_time">时间</th>
              <th class="tb_type">类型</th>
              <th class="tb_content">内容</th>
            </tr>
          </table>
          <div class="panel-footer"></div>
        </div>

        <h3>正在处理风险预警信息</h3>
        <div class="table1" style="overflow-y: scroll;">
          <table id="wn_tb2">
            <tr>
              <th class="tb_zhidui">支队</th>
              <th class="tb_time">时间</th>
              <th class="tb_type">类型</th>
              <th class="tb_content">内容</th>
            </tr>
          </table>
          <div class="panel-footer"></div>
        </div>
        <div class="panel-footer"></div>
      </div>

      <div class="panel line1">
        <h2 onclick="toSmartDetail()">智慧队站</h2>
        <div class="chart" id="smart"></div>
        <!-- <div class="half-div" id="smart_1"></div>
        <div class="quarter-div" id="smart_2"></div>
        <div class="quarter-div" id="smart_3"></div> -->
        <div class="panel-footer"></div>
      </div>
    </div>
  </section>
  <div id="simpleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="closeBtn">&times;</span>
        <h2>预 警 信 息 查 看</h2>
      </div>
      <div class="modal-body">
        <p style="font-size: 0.3rem; text-align: center;">最新风险预警信息</p>
        <ul id="modal-ul">
          <li></li>
          <li></li>
          <li></li>
        </ul>
        <!-- <form>
          处理状态:&nbsp;<input type="radio" name="state" value="0">待处理&nbsp;
          <input type="radio" name="state" value="3">交由下级督办<br>
        </form> -->
        <!-- <div class="handle">
          <button onclick="submit()">保存</button>
          <button onclick="closeModal()">关闭</button>
        </div> -->
      </div>
      <!-- <div class="modal-footer">
            <h3>弹框底部</h3>
        </div> -->
    </div>
  </div>
  <div id="mb">
    <div id="loading">
      报告生成中
    </div>
  </div>
</body>
<script src="../js/flexible.js"></script>
<script src="../js/jquery.js"></script>
<script src="../js/echarts.min.js"></script>
<script src="../js/echartsMap.js"></script>
<script src="../js/mapData.js"></script>
<script src="../js/api.js"></script>
<script src="../js/spin.min.js"></script>
<script src="../js/baiduMap.js"></script>

<script src="../js/main/heart.js"></script>
<script src="../js/main/dj.js"></script>
<script src="../js/main/edu.js"></script>
<script src="../js/main/assess.js"></script>
<script src="../js/main/smart.js"></script>
<script src="../js/main/warn.js"></script>
<script src="../js/main/date.js"></script>
<script src="../js/loading.js"></script>


<script>
  // onload
  $(function () {
    localStorage.setItem("url", "http://localhost:8880/")
    console.log(localStorage.getItem("unitName"))
    console.log(localStorage.getItem("unitId"))
    console.log(localStorage.getItem("level"))

    if (localStorage.getItem("month") == "undefined" || localStorage.getItem("month") == null) {
      function addDateZero(num) {
        return (num < 10 ? "0" + num : num);
      }
      var myDate = new Date();
      var month = myDate.getFullYear() + "-" + addDateZero(myDate.getMonth() + 1);
      localStorage.setItem("month", month)
      console.log(localStorage.getItem("month"))
    }
    if (localStorage.getItem("unitId") == "undefined" || localStorage.getItem("unitId") == null) {
      localStorage.setItem("unitId", 1)
    }
    getPartyBuildData();
    getHeartData();
    getEduData();
    smart();

    getAssessData();

    tb_edu();
    tb_wn1();
    tb_wn2();

    $.ajax({
      type: 'GET',
      url: localStorage.getItem("url") + 'unit/getUnitById',
      traditional: true,
      data: {
        id: localStorage.getItem("unitId")
      },
      success: function (response) {
        document.getElementById("totalNum").innerHTML = response.extra.unit.totalNum;
        document.getElementById("activeNum").innerHTML = response.extra.unit.activeNum;
        document.getElementById("keyNum").innerHTML = response.extra.unit.keyNum;
      },
      error: function (response) {
        console.log(response);
      }
    })
  });

  // 获取弹窗元素
  var modal = document.getElementById("simpleModal");

  // 获取关闭弹窗按钮元素
  var closeBtn = document.getElementsByClassName("closeBtn")[0];

  // 监听关闭弹窗事件
  closeBtn.addEventListener("click", closeModal);

  // 监听window关闭弹窗事件
  window.addEventListener("click", outsideClick);

  // 关闭弹框事件
  function closeModal() {
    // $('form')[0].reset();
    modal.style.display = "none";
  }

  // outsideClick
  function outsideClick(e) {
    if (e.target == modal) {
      modal.style.display = "none";
    }
  }



  function submit() {
    var data = $('form').serializeArray();
    console.log(data);
    modal.style.display = "none";
  }

  function toDjDetail() {
    window.location = './detail/djDetail.html'
  }

  function toEduDetail() {
    window.location = './detail/eduDetail.html'
  }

  function toHeartDetail() {
    window.location = './detail/heartDetail.html'
  }

  function toSmartDetail() {
    window.location = './detail/smartDetail.html'
  }

  function toAssessDetail() {
    window.location = './detail/assessDetail.html'
  }

  function downloadReport() {
    startLoading();
    var link = document.createElement("a");
    $.ajax({
      type: 'GET',
      url: localStorage.getItem("url") + 'poi/getReport',
      data: {
        unitId: localStorage.getItem("unitId"),
        month: localStorage.getItem("month"),
      },
      success: function (response) {
        let url = '../static/jx/result.docx'
        link.setAttribute('href', url)
        if (link.download !== undefined) {
          link.download = "月报.docx";
        }
        link.click();
        stopLoading();
      },
      error: function (response) {
        console.log(response);
        stopLoading();
      }
    })
  }

  function back() {
    $.ajax({
      type: 'GET',
      url: localStorage.getItem("url") + 'unit/getFatherID',
      // traditional: true,
      data: {
        id: localStorage.getItem("unitId")
      },
      success: function (response) {
        localStorage.setItem("unitId", response.extra.fatherId)
        localStorage.setItem("unitName", response.extra.unitName)
        localStorage.setItem("level", response.extra.unitLevel)
        console.log(localStorage.getItem("unitName"))
        location.reload();
      },
      error: function (response) {
        console.log(response);
      }
    })

  }
</script>

</html>